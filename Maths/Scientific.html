<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scientific Calculator — Fixvity</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f3f7fb;
    --card:#ffffff;
    --accent:#1f6fb6;        /* deep blue */
    --muted:#6b7280;
    --soft:#e9f2f9;
    --btn:#d9e9f7;
    --danger:#e76f51;
    --radius:14px;
    --shadow: 0 10px 30px rgba(16,24,40,0.06);
    --glass: rgba(255,255,255,0.7);
    --gap:10px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#0b1220;background:linear-gradient(180deg,#f7fbfe,#f3f7fb);-webkit-font-smoothing:antialiased}
  .wrap{max-width:520px;margin:18px auto;padding:14px}
  header{margin-bottom:10px}
  h1{margin:4px 0 6px;font-size:28px;color:var(--accent);font-weight:800}
  p.lead{margin:0 0 14px;color:var(--muted);font-size:14px}

  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;margin-bottom:14px}
  /* Display */
  .display{
    background:linear-gradient(90deg,#2d6da8,#1f5f86);
    color:#fff;border-radius:10px;padding:10px 14px;min-height:72px;display:flex;flex-direction:column;justify-content:center;gap:6px;
  }
  .expr{color:rgba(255,255,255,0.9);font-size:13px;opacity:0.98;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .result{font-size:28px;font-weight:700;letter-spacing:0.3px;display:flex;align-items:center;justify-content:space-between}
  .right-muted{font-size:12px;color:rgba(255,255,255,0.85)}

  /* small controls */
  .top-controls{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
  .seg{display:flex;gap:8px;background:var(--soft);padding:6px;border-radius:10px}
  .seg label{display:inline-flex;align-items:center;gap:6px;color:var(--muted);font-size:14px}
  .seg input[type="radio"]{accent-color:var(--accent);transform:scale(1.05)}

  /* keypad grid */
  .pad{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;padding-top:10px}
  .btn{background:var(--btn);border-radius:10px;padding:12px 8px;text-align:center;font-weight:600;color:#083049;border:0;cursor:pointer;box-shadow:inset 0 -2px rgba(0,0,0,0.03);transition:transform .06s ease, box-shadow .06s ease}
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:#fff;border:1px solid rgba(16,24,40,0.06);color:#083049;font-weight:700}
  .btn.big{grid-column:span 2}
  .btn.equal{background:var(--accent);color:#fff;grid-column:span 1;box-shadow:none}
  .btn.accent{background:linear-gradient(180deg,#e8f3fb,#d9eafc);color:var(--accent);font-weight:800}
  .btn.gray{background:#f6f8fa;color:var(--muted)}
  .btn.round{border-radius:8px}

  /* responsive tweaks */
  @media (max-width:420px){
    .wrap{padding:12px}
    h1{font-size:24px}
    .result{font-size:24px}
    .pad{gap:8px}
    .btn{padding:10px 6px;font-size:15px}
  }

  /* keyboard focus */
  .btn:focus{outline:3px solid rgba(31,111,182,0.12)}
  input[type="text"]{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef8}
  .footer{font-size:12px;color:var(--muted);margin-top:8px;text-align:center}
  /* subtle hover */
  .btn:hover{box-shadow:0 6px 18px rgba(16,24,40,0.06)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Scientific Calculator</h1>
      <p class="lead">Powerful, responsive, mobile-first scientific calculator — keyboard friendly and accurate for everyday use.</p>
    </header>

    <div class="card">
      <div id="display" class="display" aria-live="polite">
        <div id="expr" class="expr" title=""></div>
        <div class="result">
          <div id="resultText">0</div>
          <div class="right-muted" id="modeLabel">Deg</div>
        </div>
      </div>

      <div class="top-controls" style="margin-top:12px;justify-content:space-between;align-items:center">
        <div style="display:flex;gap:8px;align-items:center">
          <div class="seg" role="radiogroup" aria-label="Angle unit">
            <label><input type="radio" name="angle" value="deg" checked> Deg</label>
            <label><input type="radio" name="angle" value="rad"> Rad</label>
          </div>
          <div style="margin-left:6px;color:var(--muted);font-size:13px">Ans: <strong id="ansLabel">0</strong></div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn secondary" id="btnAC" title="Clear all (AC)">AC</button>
          <button class="btn secondary" id="btnBack" title="Backspace">Back</button>
        </div>
      </div>

      <div class="pad" style="margin-top:12px">
        <!-- row1 -->
        <button class="btn" data-fn="sin">sin</button>
        <button class="btn" data-fn="cos">cos</button>
        <button class="btn" data-fn="tan">tan</button>
        <button class="btn" data-fn="pi">π</button>
        <button class="btn" data-fn="e">e</button>

        <!-- row2 -->
        <button class="btn" data-fn="asin">sin⁻¹</button>
        <button class="btn" data-fn="acos">cos⁻¹</button>
        <button class="btn" data-fn="atan">tan⁻¹</button>
        <button class="btn" data-fn="powxy">xʸ</button>
        <button class="btn" data-fn="pow3">x³</button>

        <!-- row3 -->
        <button class="btn" data-fn="pow2">x²</button>
        <button class="btn" data-fn="exp">eˣ</button>
        <button class="btn" data-fn="tenx">10ˣ</button>
        <button class="btn" data-fn="ln">ln</button>
        <button class="btn" data-fn="log">log</button>

        <!-- row4 -->
        <button class="btn" data-fn="sqrt">√x</button>
        <button class="btn" data-fn="cuberoot">³√x</button>
        <button class="btn" data-fn="nthroot">y√x</button>
        <button class="btn" data-fn="percent">%</button>
        <button class="btn" data-fn="fact">n!</button>

        <!-- row5 numbers/operators -->
        <button class="btn" data-key="7">7</button>
        <button class="btn" data-key="8">8</button>
        <button class="btn" data-key="9">9</button>
        <button class="btn" data-op="+">+</button>
        <button class="btn accent" id="btnAns">Ans</button>

        <button class="btn" data-key="4">4</button>
        <button class="btn" data-key="5">5</button>
        <button class="btn" data-key="6">6</button>
        <button class="btn" data-op="-">−</button>
        <button class="btn accent" id="btnMplus">M+</button>

        <button class="btn" data-key="1">1</button>
        <button class="btn" data-key="2">2</button>
        <button class="btn" data-key="3">3</button>
        <button class="btn" data-op="*">×</button>
        <button class="btn accent" id="btnMminus">M-</button>

        <button class="btn" data-key="0">0</button>
        <button class="btn" data-key=".">.</button>
        <button class="btn" data-fn="expNotation">EXP</button>
        <button class="btn" data-op="/">÷</button>
        <button class="btn accent" id="btnMR">MR</button>

        <button class="btn gray" data-fn="neg">±</button>
        <button class="btn gray" data-fn="rand">RND</button>
        <button class="btn secondary big equal" id="btnEq">=</button>
        <button class="btn gray" data-fn="open">(</button>
        <button class="btn gray" data-fn="close">)</button>
      </div>

      <div class="footer">Tip: Use your keyboard — numbers, + - * / and Enter work. Trig respects selected angle unit.</div>
    </div>
  </div>

<script>
/*
  Simple safe expression handling strategy:
  - Build expression string by buttons / keyboard
  - For complex single-argument functions (sin, sqrt, ln, etc.) we apply them directly to current displayed value
  - For arithmetic expression evaluation we sanitize allowed characters and use Function(...) to compute.
  - We avoid injecting arbitrary text into the evaluator.
*/

const exprEl = document.getElementById('expr');
const resultEl = document.getElementById('resultText');
const modeLabel = document.getElementById('modeLabel');
const ansLabel = document.getElementById('ansLabel');

let expression = '';    // user-built expression used for showing (keeps things simple)
let ans = 0;
let memory = 0;
let angleMode = 'deg';  // or 'rad'

function updateDisplay(){
  exprEl.textContent = expression || '';
  exprEl.title = expression || '';
  resultEl.textContent = (expression ? '' : formatNumber(ans));
  ansLabel.textContent = formatNumber(ans);
  modeLabel.textContent = (angleMode === 'deg' ? 'Deg' : 'Rad');
}

/* helpers */
function formatNumber(n){
  if (n === null || n === undefined) return '0';
  if (!isFinite(n)) return String(n);
  // show up to 12 significant digits neatly
  const abs = Math.abs(n);
  if (abs >= 1e9 || (abs > 0 && abs < 1e-6)) return n.toExponential(6);
  return Number.isInteger(n) ? n.toLocaleString() : n.toLocaleString(undefined, {maximumFractionDigits:10});
}

function sanitizeForEval(s){
  // allow digits, operators, parentheses, decimal, spaces, exponent notation 'e', and ** for power
  // also allow Math. prefixes if we decide to use them - but we'll transform pi,e -> Math.PI etc.
  // Remove any characters not allowed
  return s.replace(/[^0-9+\-*/().,%^eE\s\*]/g, '');
}

function safeEval(raw){
  // transform user tokens into a safe JS expression
  // Convert unicode operators
  let s = String(raw);
  s = s.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-').replace(/,/g,'');
  // replace caret ^ with ** for power
  s = s.replace(/\^/g,'**');
  // replace π and PI with Math.PI, e with Math.E if in isolation
  s = s.replace(/π|PI\b/g, 'Math.PI');
  // We allow 'Ans' token -> numeric value
  s = s.replace(/\bAns\b/g, String(ans));
  // percent x% treated as (x/100)
  s = s.replace(/([0-9\.]+)%/g, '($1/100)');
  // final sanitization - only allow characters we expect (digits, operators, Math., parentheses, whitespace)
  // But Math. is allowed: keep letters and dot only for Math
  // Remove unexpected sequences
  if (/[^0-9+\-*/().%MathPIE\sEe\*]/.test(s)) {
    // fallback: strictly remove anything unsafe
    s = s.replace(/[^0-9+\-*/().%*\sMathPIEe]/g,'');
  }
  try{
    // Use Function to evaluate
    // Also ensure angle-mode functions (sin/cos) used externally, here only arithmetic
    return Function('"use strict"; return (' + s + ')')();
  }catch(e){
    throw new Error('Invalid expression');
  }
}

/* apply single-arg functions to current numeric value */
function currentValue(){
  // if expression is empty, use ans; else try to evaluate expression as numeric
  if (!expression) return ans || 0;
  try{
    return safeEval(expression);
  }catch(e){
    return NaN;
  }
}

/* button actions */
document.querySelectorAll('.pad .btn').forEach(b=>{
  b.addEventListener('click', ()=> {
    const key = b.dataset.key;
    const op = b.dataset.op;
    const fn = b.dataset.fn;

    if (key) { expression += key; updateDisplay(); return; }
    if (op)  { expression += op; updateDisplay(); return; }
    if (fn)  { handleFn(fn); return; }

    // special buttons by id
  });
});

document.getElementById('btnAC').addEventListener('click', ()=>{
  expression = '';
  ans = 0;
  updateDisplay();
});
document.getElementById('btnBack').addEventListener('click', ()=>{
  if (expression.length) expression = expression.slice(0,-1);
  updateDisplay();
});
document.getElementById('btnEq').addEventListener('click', doEquals);
document.getElementById('btnAns').addEventListener('click', ()=>{
  expression += String(ans);
  updateDisplay();
});

/* memory buttons */
document.getElementById('btnMplus').addEventListener('click', ()=>{
  const v = currentValue();
  if (!isNaN(v)) memory += v;
  updateDisplay();
});
document.getElementById('btnMminus').addEventListener('click', ()=>{
  const v = currentValue();
  if (!isNaN(v)) memory -= v;
  updateDisplay();
});
document.getElementById('btnMR').addEventListener('click', ()=>{
  expression += String(memory);
  updateDisplay();
});

/* angle radio */
document.querySelectorAll('input[name="angle"]').forEach(r=>{
  r.addEventListener('change', (ev)=>{
    angleMode = ev.target.value;
    updateDisplay();
  });
});

/* functions implementation */
function handleFn(name){
  try{
    switch(name){
      case 'pi': expression += 'π'; updateDisplay(); break;
      case 'e': expression += 'e'; updateDisplay(); break;
      case 'expNotation': expression += 'e'; updateDisplay(); break;
      case 'neg':
        // toggle sign of last number in expression or apply to current value
        toggleSign(); break;
      case 'rand':
        expression = String(Math.random()); updateDisplay(); break;
      case 'sqrt': applyUnary(Math.sqrt); break;
      case 'cuberoot': applyUnary(x=>Math.sign(x)*Math.abs(x)**(1/3)); break;
      case 'nthroot': applyNthRoot(); break;
      case 'powxy': expression += '^'; updateDisplay(); break;
      case 'pow2': applyUnary(x=>x**2); break;
      case 'pow3': applyUnary(x=>x**3); break;
      case 'exp': applyUnary(x=>Math.exp(x)); break;
      case 'tenx': applyUnary(x=>10**x); break;
      case 'ln': applyUnary(x=>Math.log(x)); break;
      case 'log': applyUnary(x=>Math.log10(x)); break;
      case 'sin': applyTrig('sin'); break;
      case 'cos': applyTrig('cos'); break;
      case 'tan': applyTrig('tan'); break;
      case 'asin': applyTrig('asin'); break;
      case 'acos': applyTrig('acos'); break;
      case 'atan': applyTrig('atan'); break;
      case 'percent': applyUnary(x=>x/100); break;
      case 'fact': applyFactorial(); break;
      case 'open': expression += '('; updateDisplay(); break;
      case 'close': expression += ')'; updateDisplay(); break;
      default: break;
    }
  }catch(err){
    alert(err.message || 'Error');
  }
}

/* toggle sign (best-effort) */
function toggleSign(){
  // try to find last number token and negate it
  if (!expression) { expression = String(-ans); updateDisplay(); return; }
  const m = expression.match(/([0-9.]+)(?!.*[0-9.])/);
  if (m){
    const num = m[0];
    const idx = expression.lastIndexOf(num);
    const before = expression.slice(0, idx);
    const after = expression.slice(idx + num.length);
    const newNum = (Number(num) * -1).toString();
    expression = before + newNum + after;
    updateDisplay();
  } else {
    // fallback: wrap whole expression
    expression = '(' + expression + ')*-1';
    updateDisplay();
  }
}

/* apply simple unary function to currentValue and replace expression with result */
function applyUnary(fn){
  const v = currentValue();
  if (isNaN(v)) { alert('Invalid input'); return; }
  let res = fn(v);
  if (!isFinite(res)) { alert('Result not finite'); return; }
  expression = String(res);
  ans = res;
  updateDisplay();
}

/* factorial (integer only) */
function applyFactorial(){
  let v = currentValue();
  if (!Number.isInteger(v) || v < 0) { alert('Factorial requires a non-negative integer'); return; }
  if (v > 170) { alert('Number too large'); return; } // 170! exceeds JS Number range
  let f = 1;
  for(let i=2;i<=v;i++) f *= i;
  expression = String(f);
  ans = f;
  updateDisplay();
}

/* nth root: prompt for degree y, compute y√x */
function applyNthRoot(){
  const y = prompt('Enter root degree (e.g. 3 for cube root) — default 2:', '2');
  if (y === null) return;
  const deg = Number(y);
  if (!deg || deg === 0) { alert('Invalid degree'); return; }
  const v = currentValue();
  let res = Math.sign(v) * Math.abs(v) ** (1/deg);
  expression = String(res);
  ans = res;
  updateDisplay();
}

/* Trig wrapper handling deg/rad */
function applyTrig(kind){
  const v = currentValue();
  if (isNaN(v)) { alert('Invalid input'); return; }
  const inRad = (angleMode === 'deg') ? v * Math.PI / 180 : v;
  let r;
  switch(kind){
    case 'sin': r = Math.sin(inRad); break;
    case 'cos': r = Math.cos(inRad); break;
    case 'tan': r = Math.tan(inRad); break;
    case 'asin': r = angleMode === 'deg' ? Math.asin(v) * 180/Math.PI : Math.asin(v); break;
    case 'acos': r = angleMode === 'deg' ? Math.acos(v) * 180/Math.PI : Math.acos(v); break;
    case 'atan': r = angleMode === 'deg' ? Math.atan(v) * 180/Math.PI : Math.atan(v); break;
  }
  if (!isFinite(r)) { alert('Result not finite'); return; }
  expression = String(r);
  ans = r;
  updateDisplay();
}

/* equals / evaluate */
function doEquals(){
  if (!expression) { updateDisplay(); return; }
  try{
    // Quick replace: '^' -> '**', unicode ops to JS symbols
    let toEval = expression.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-').replace(/π/g,'Math.PI').replace(/\bpi\b/gi,'Math.PI').replace(/\be\b/g,'Math.E');
    // Replace trailing percent occurrences like "50%" -> "(50/100)"
    toEval = toEval.replace(/([0-9.]+)%/g,'($1/100)');
    // Replace 'Ans' token
    toEval = toEval.replace(/\bAns\b/g, String(ans));
    // caret to JS power
    toEval = toEval.replace(/\^/g,'**');

    // safety check: allow only numbers, operators, Math and parentheses and whitespace
    if (/[^0-9+\-*/().%*\sMathPIEenaAnsEe]/.test(toEval)) {
      // If suspicious, throw
      throw new Error('Invalid characters in expression');
    }

    const val = Function('"use strict"; return (' + toEval + ')')();
    if (typeof val === 'number' && !isNaN(val) && isFinite(val)){
      ans = val;
      expression = ''; // clear expression and show ans as default
      updateDisplay();
    }else{
      throw new Error('Computation failed');
    }
  }catch(err){
    alert('Error: ' + (err.message || 'Invalid expression'));
  }
}

/* keyboard support */
window.addEventListener('keydown', (e)=>{
  const key = e.key;
  if ((/^[0-9]$/).test(key)) { expression += key; updateDisplay(); return; }
  if (key === '.') { expression += '.'; updateDisplay(); return; }
  if (key === 'Enter' || key === '=') { e.preventDefault(); doEquals(); return; }
  if (key === 'Backspace') { expression = expression.slice(0,-1); updateDisplay(); return; }
  if (key === '+' || key === '-' || key === '*' || key === '/') { expression += key; updateDisplay(); return; }
  if (key === '(' || key === ')') { expression += key; updateDisplay(); return; }
  if (key === '^') { expression += '^'; updateDisplay(); return; }
});

/* initialise */
updateDisplay();

/* expose helpers for debug (optional) */
window._calc = {getExpression: ()=>expression, setExpression: (s)=>{expression=String(s); updateDisplay()}, eval: doEquals};

</script>
</body>
</html>
