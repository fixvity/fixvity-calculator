<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scientific Calculator — Verified Working</title>
<style>
  :root{
    --bg:#07121a; --page:#ffffff; --key:#12202a; --accent:#10b981; --danger:#dc2626; --muted:#94a3b8;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  html,body{height:100%;margin:0;background:var(--page);display:flex;align-items:center;justify-content:center;padding:24px}
  .calc{width:360px;max-width:96vw;background:linear-gradient(180deg,var(--bg),#05101a);border-radius:16px;box-shadow:0 18px 50px rgba(9,16,23,0.12);color:#e6eef8;overflow:hidden;display:flex;flex-direction:column}
  .top{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;justify-content:space-between;align-items:center}
  .title{font-weight:700;font-size:16px}
  .modes button{border:0;padding:6px 10px;border-radius:999px;background:transparent;color:var(--muted);cursor:pointer}
  .modes .active{background:var(--accent);color:#04201b}
  .displayWrap{padding:12px}
  .display{background:#fff;border-radius:10px;padding:12px;min-height:86px;color:#041018;display:flex;flex-direction:column;justify-content:center}
  .expr{color:#334155;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .value{font-size:34px;text-align:right;font-family:ui-monospace,Menlo,monospace;margin-top:6px}
  .statusRow{font-size:12px;color:var(--muted);display:flex;justify-content:space-between;padding:6px 12px}
  .keys{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;padding:12px;box-sizing:border-box}
  .key{background:var(--key);border-radius:12px;padding:10px;font-size:14px;border:0;color:#e6f0fb;cursor:pointer;min-height:44px;display:flex;align-items:center;justify-content:center;box-shadow:inset 0 -3px 0 rgba(0,0,0,0.25)}
  .key:active{transform:translateY(0);background:#0b2e2f}
  .key.ac{background:var(--danger);color:white}
  .key.equals{background:linear-gradient(180deg,var(--accent),#05956f);color:#04201b}
  .key.wide{grid-column:span 2}
  .note{font-size:12px;color:var(--muted);padding:6px 12px}
</style>
</head>
<body>
  <div class="calc" id="calculator">
    <div class="top">
      <div class="title">Scientific Calculator</div>
      <div class="modes">
        <button id="deg" class="active">Deg</button>
        <button id="rad">Rad</button>
      </div>
    </div>

    <div class="displayWrap">
      <div class="display" aria-live="polite">
        <div id="exprSmall" class="expr"></div>
        <div id="exprBig" class="value">0</div>
      </div>
      <div class="statusRow">
        <div id="jsStatus">JS: <strong id="jsReady" style="color:#10b981">loading</strong></div>
        <div id="memAns">Memory: 0 &nbsp;&nbsp; Ans: 0</div>
      </div>
    </div>

    <div class="keys" id="keys" role="group" aria-label="Calculator buttons">
      <!-- Row1 -->
      <button class="key" data-key="sin(">sin</button>
      <button class="key" data-key="cos(">cos</button>
      <button class="key" data-key="tan(">tan</button>
      <button class="key" data-key="asin(">sin⁻¹</button>
      <button class="key" data-key="acos(">cos⁻¹</button>
      <button class="key" data-key="atan(">tan⁻¹</button>

      <!-- Row2 -->
      <button class="key" data-key="^">xʸ</button>
      <button class="key" data-key="^3">x³</button>
      <button class="key" data-key="^2">x²</button>
      <button class="key" data-key="sqrt(">√x</button>
      <button class="key" data-key="cbrt(">³√x</button>
      <button class="key" data-key="root(">y√x</button>

      <!-- Row3 -->
      <button class="key" data-key="expE(">eˣ</button>
      <button class="key" data-key="exp10(">10ˣ</button>
      <button class="key" data-key="PI">π</button>
      <button class="key" data-key="E">e</button>
      <button class="key" data-key="(">(</button>
      <button class="key" data-key=")">)</button>

      <!-- Row4 -->
      <button class="key" data-key="1/x">1/x</button>
      <button class="key" data-key="%">%</button>
      <button class="key" data-key="!">n!</button>
      <button class="key" data-key="rand">RND</button>
      <button class="key" data-key="ln(">ln</button>
      <button class="key" data-key="log(">log</button>

      <!-- Row5 -->
      <button class="key ac" data-key="AC">AC</button>
      <button class="key" data-key="back">⌫</button>
      <button class="key" data-key="neg">±</button>
      <button class="key" data-key="CE">CE</button>
      <button class="key" data-key="MC">MC</button>
      <button class="key" data-key="MR">MR</button>

      <!-- Row6 -->
      <button class="key" data-key="7">7</button>
      <button class="key" data-key="8">8</button>
      <button class="key" data-key="9">9</button>
      <button class="key" data-key="/">÷</button>
      <button class="key" data-key="M+">M+</button>
      <button class="key" data-key="M-">M-</button>

      <!-- Row7 -->
      <button class="key" data-key="4">4</button>
      <button class="key" data-key="5">5</button>
      <button class="key" data-key="6">6</button>
      <button class="key" data-key="*">×</button>
      <button class="key" data-key="Ans">Ans</button>
      <button class="key" data-key="EXP">EXP</button>

      <!-- Row8 -->
      <button class="key" data-key="1">1</button>
      <button class="key" data-key="2">2</button>
      <button class="key" data-key="3">3</button>
      <button class="key" data-key="-">-</button>
      <button class="key" data-key="E_not">E</button>
      <button class="key" style="visibility:hidden">_</button>

      <!-- Row9 -->
      <button class="key" data-key="-space">-</button>
      <button class="key wide" data-key="0">0</button>
      <button class="key" data-key=".">.</button>
      <button class="key" data-key="+">+</button>
      <button class="key equals" data-key="=">=</button>
      <div></div>
    </div>

    <div class="note" id="note">Tip: if buttons don’t respond, make sure JavaScript is enabled and open this file in a browser (Chrome recommended).</div>
  </div>

<script>
/* Ensure script runs after DOM built */
document.addEventListener('DOMContentLoaded', ()=>{

  // UI refs
  const exprSmall = document.getElementById('exprSmall');
  const exprBig = document.getElementById('exprBig');
  const keys = document.getElementById('keys');
  const jsReady = document.getElementById('jsReady');
  const memAns = document.getElementById('memAns');
  const memVal = document.getElementById('memVal') || null;
  const ansVal = document.getElementById('ansVal') || null;

  // State
  let expression = '';
  let memory = 0;
  let ANS = 0;
  let degMode = true;

  // confirm JS loaded in UI
  jsReady.textContent = 'ready';

  // Small helpers
  function normalizeNum(x){
    if(typeof x !== 'number' || !isFinite(x)) return x;
    return Number.parseFloat(x.toPrecision(12));
  }
  function updateUI(){
    exprSmall.textContent = expression;
    exprBig.textContent = expression === '' ? '0' : expression;
    // update status row
    const statusEl = document.getElementById('memAns');
    if(statusEl) statusEl.textContent = `Memory: ${memory}   Ans: ${ANS}`;
  }

  // SIMPLE tokenizer/eval pipeline (same robust engine as before)
  function tokenize(s){
    s = String(s);
    const tokens=[]; let i=0;
    const reNum = /^[0-9]+(?:\.[0-9]*)?(?:[eE][+\-]?\d+)?/;
    const reId  = /^[A-Za-z_][A-Za-z0-9_]*/;
    while(i<s.length){
      const ch = s[i];
      if(/\s/.test(ch)){ i++; continue; }
      const mNum = s.slice(i).match(reNum);
      if(mNum){ tokens.push({type:'number',v:mNum[0]}); i+=mNum[0].length; continue; }
      const mId = s.slice(i).match(reId);
      if(mId){ tokens.push({type:'ident',v:mId[0]}); i+=mId[0].length; continue; }
      if(ch==='+'||ch==='-'||ch==='*'||ch==='/'||ch==='^'||ch==='('||ch===')'||ch===','){ tokens.push({type:'op',v:ch}); i++; continue; }
      if(ch==='!'){ tokens.push({type:'post',v:'!'}); i++; continue; }
      if(ch==='%'){ tokens.push({type:'post',v:'%'}); i++; continue; }
      if(ch==='π'){ tokens.push({type:'ident',v:'PI'}); i++; continue; }
      tokens.push({type:'unknown',v:ch}); i++;
    }
    return tokens;
  }

  function toRPN(tokens){
    const out=[], ops=[]; const prec={'+' :2,'-':2,'*':3,'/':3,'^':4}; const right={'^':true};
    function isFunc(t,i){ return t.type==='ident' && tokens[i+1] && tokens[i+1].type==='op' && tokens[i+1].v==='('; }
    for(let i=0;i<tokens.length;i++){
      const t=tokens[i];
      if(t.type==='number' || (t.type==='ident' && !isFunc(t,i))){ out.push(t); continue; }
      if(isFunc(t,i)){ ops.push({type:'func',v:t.v}); continue; }
      if(t.type==='op'){
        if(t.v==='('){ ops.push(t); continue; }
        if(t.v===')'){ while(ops.length && !(ops[ops.length-1].type==='op' && ops[ops.length-1].v==='(')) out.push(ops.pop()); if(ops.length && ops[ops.length-1].type==='op' && ops[ops.length-1].v==='(') ops.pop(); if(ops.length && ops[ops.length-1].type==='func') out.push(ops.pop()); continue; }
        const prev = tokens[i-1];
        if(t.v==='-' && (!prev || (prev.type==='op' && prev.v!==')') || prev.type==='post')){ ops.push({type:'op',v:'u-'}); continue; }
        while(ops.length){
          const top=ops[ops.length-1];
          if(top.type==='op' && top.v!=='('){
            const tp=prec[top.v]||0, cp=prec[t.v]||0;
            if((!right[t.v] && cp<=tp) || (right[t.v] && cp<tp)){ out.push(ops.pop()); continue; }
          } else if(top.type==='func'){ out.push(ops.pop()); continue; }
          break;
        }
        ops.push(t); continue;
      }
      if(t.type==='post'){ out.push(t); continue; }
      out.push(t);
    }
    while(ops.length) out.push(ops.pop());
    return out;
  }

  function evalRPN(rpn){
    const st=[];
    const consts = {PI:Math.PI, E:Math.E, Ans:ANS};
    const funcs = {
      sin:(x)=> degMode?Math.sin(x*Math.PI/180):Math.sin(x),
      cos:(x)=> degMode?Math.cos(x*Math.PI/180):Math.cos(x),
      tan:(x)=> degMode?Math.tan(x*Math.PI/180):Math.tan(x),
      asin:(x)=> degMode?Math.asin(x)*180/Math.PI:Math.asin(x),
      acos:(x)=> degMode?Math.acos(x)*180/Math.PI:Math.acos(x),
      atan:(x)=> degMode?Math.atan(x)*180/Math.PI:Math.atan(x),
      ln:(x)=> Math.log(x),
      log:(x)=> (Math.log10?Math.log10(x):Math.log(x)/Math.LN10),
      expE:(x)=> Math.exp(x),
      exp10:(x)=> Math.pow(10,x),
      sqrt:(x)=> Math.sqrt(x),
      cbrt:(x)=> Math.cbrt?Math.cbrt(x):Math.pow(x,1/3),
      root:(y,x)=> Math.pow(x,1/y),
      rand:()=> Math.random()
    };
    for(const t of rpn){
      if(t.type==='number') st.push(Number(t.v));
      else if(t.type==='ident') st.push(t.v in consts ? consts[t.v] : NaN);
      else if(t.type==='post'){
        if(t.v==='!'){ const a=st.pop(); const n=Number(a); if(!Number.isInteger(n)||n<0) throw Error('factorial'); if(n>170) throw Error('overflow'); let r=1; for(let i=1;i<=n;i++) r*=i; st.push(r); }
        else if(t.v==='%'){ const a=st.pop(); st.push(Number(a)/100); }
      } else if(t.type==='op'){
        if(t.v==='u-'){ const a=st.pop(); st.push(-Number(a)); }
        else { const b=st.pop(); const a=st.pop(); if(t.v==='+') st.push(Number(a)+Number(b)); else if(t.v==='-') st.push(Number(a)-Number(b)); else if(t.v==='*') st.push(Number(a)*Number(b)); else if(t.v==='/'){ if(Number(b)===0) throw Error('div0'); st.push(Number(a)/Number(b)); } else if(t.v==='^') st.push(Math.pow(Number(a),Number(b))); else throw Error('op'); }
      } else if(t.type==='func'){
        if(t.v==='root'){ const x=st.pop(); const y=st.pop(); st.push(funcs.root(Number(y),Number(x))); }
        else { const a=st.pop(); if(!(t.v in funcs)) throw Error('func'); st.push(funcs[t.v](Number(a))); }
      } else { st.push(NaN); }
    }
    if(st.length!==1) throw Error('syntax');
    return st[0];
  }

  function prepareEval(raw){
    if(!raw || raw.trim()==='') return 0;
    let s = String(raw).replace(/×/g,'*').replace(/÷/g,'/');
    s = s.replace(/(\d)(PI|Ans|E|\()/g,'$1*$2').replace(/(\))(\d|PI|Ans|E|\()/g,')*$2');
    const tokens = tokenize(s);
    const rpn = toRPN(tokens);
    const result = evalRPN(rpn);
    return normalizeNum(result);
  }

  // Attach listener using delegation
  keys.addEventListener('click', (ev)=>{
    const b = ev.target.closest('button');
    if(!b) return;
    const k = b.dataset.key;
    handleKey(k);
  });

  // basic keyboard
  window.addEventListener('keydown', (ev)=>{
    if(ev.key==='Enter'){ handleKey('='); ev.preventDefault(); return; }
    if(ev.key==='Escape'){ handleKey('AC'); ev.preventDefault(); return; }
    if(ev.key==='Backspace'){ handleKey('back'); ev.preventDefault(); return; }
    if(/[0-9]/.test(ev.key)) handleKey(ev.key);
    if(ev.key==='.') handleKey('.');
    if(ev.key==='+') handleKey('+');
    if(ev.key==='-') handleKey('-');
    if(ev.key==='*') handleKey('*');
    if(ev.key==='/') handleKey('/');
  });

  function handleKey(k){
    try{
      switch(k){
        case 'AC': expression=''; updateUI(); break;
        case 'CE': expression = expression.replace(/\s*([A-Za-z_][A-Za-z0-9_]*|\d+\.?\d*(?:[eE][+\-]?\d+)?|\S)$/, ''); updateUI(); break;
        case 'back': expression = expression.slice(0,-1); updateUI(); break;
        case '=':
          try{
            const res = prepareEval(expression);
            expression = String(res);
            ANS = (typeof res === 'number') ? res : Number(res)||0;
            exprSmall.textContent = '';
            exprBig.textContent = expression;
            updateUI();
          } catch(e){
            exprBig.textContent = 'Error';
            console.error('Evaluation error:', e);
          }
          break;
        case 'neg': expression = expression.replace(/(\d+\.?\d*(?:[eE][+\-]?\d+)?)$/, (m)=> String(-Number(m))); updateUI(); break;
        case '1/x': { const v = prepareEval(expression); if(v===0||v==='Error') exprBig.textContent='Error'; else { const r = normalizeNum(1/Number(v)); ANS=r; expression=String(r); updateUI(); } } break;
        case '%': expression += '%'; updateUI(); break;
        case '!': expression += '!'; updateUI(); break;
        case 'rand': expression = String(Math.random()); updateUI(); break;
        case 'MC': memory = 0; updateUI(); break;
        case 'MR': expression += String(memory); updateUI(); break;
        case 'M+': { const v = prepareEval(expression); if(!(v==='Error')) memory += Number(v); updateUI(); } break;
        case 'M-': { const v = prepareEval(expression); if(!(v==='Error')) memory -= Number(v); updateUI(); } break;
        case 'Ans': expression += 'Ans'; updateUI(); break;
        case 'EXP': expression += 'e'; updateUI(); break;
        case 'E_not': expression += 'E'; updateUI(); break;
        default: expression += k; updateUI();
      }
    } catch(err){
      console.error('Handle key error:', err);
      exprBig.textContent = 'Error';
    }
  }

  // Deg/Rad toggle
  document.getElementById('deg').addEventListener('click', ()=>{ degMode=true; document.getElementById('deg').classList.add('active'); document.getElementById('rad').classList.remove('active'); });
  document.getElementById('rad').addEventListener('click', ()=>{ degMode=false; document.getElementById('rad').classList.add('active'); document.getElementById('deg').classList.remove('active'); });

  // final init
  updateUI();

  // helpful debug: expose small API
  window.__calc = {
    evaluate: (s)=> { try { return prepareEval(String(s)); } catch(e){ console.error(e); return 'Error'; } },
    state: ()=> ({ expression, memory, ANS, degMode })
  };

  // Log message to console so you know script executed
  console.log('Calculator JS loaded — ready');

});
</script>
</body>
</html>
