<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pro Scientific Calculator</title>

<!-- math.js for reliable high-precision math and functions -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js" integrity="" crossorigin="anonymous"></script>

<style>
  :root{
    --bg: #f5f8fb;
    --card: #ffffff;
    --radius: 14px;
    --shadow: 0 12px 36px rgba(18,38,63,0.08);
    --accent: #145a9a;
    --number: #0b76c5;       /* numbers colour */
    --variable: #d96422;     /* variables & tokens colour */
    --muted: #6b7280;
    --btn-soft: #eef6fb;
    --btn-press: rgba(0,0,0,0.06);
    --result-btn: #1db954;   /* green */
    --clear-btn: #e1574b;    /* red */
    --glass: rgba(255,255,255,0.8);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#0b1220;background:linear-gradient(180deg,#f9fbfd,#f5f8fb);-webkit-font-smoothing:antialiased}
  .wrap{max-width:520px;margin:18px auto;padding:16px}
  header{margin-bottom:10px}
  h1{margin:0;font-size:26px;color:var(--accent);font-weight:800}
  p.lead{margin:6px 0 14px;color:var(--muted);font-size:14px}

  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;margin-bottom:14px;overflow:hidden}

  /* display */
  .display{background:linear-gradient(90deg,#2d6da8,#1f5f86);border-radius:10px;padding:12px;color:#fff;min-height:78px;display:flex;flex-direction:column;justify-content:center;gap:6px;}
  .expr {font-size:13px;opacity:0.95;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .expr .tok-num{ color: var(--number); font-weight:700; }
  .expr .tok-var{ color: var(--variable); font-weight:700; }
  .result {font-size:30px;font-weight:800;display:flex;justify-content:space-between;align-items:center}
  .mode {font-size:12px;color:rgba(255,255,255,0.9)}

  .controls {display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:8px;flex-wrap:wrap}
  .seg {display:flex;gap:8px;background:rgba(255,255,255,0.06);padding:6px;border-radius:8px}
  .seg label{display:inline-flex;align-items:center;gap:6px;color:var(--muted);font-size:13px}

  /* keypad grid */
  .pad{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:12px}
  .btn{background:var(--btn-soft);border-radius:10px;padding:12px 8px;text-align:center;font-weight:700;color:#083049;border:0;cursor:pointer;box-shadow:0 6px 12px rgba(8,12,20,0.03);transition:transform .06s ease, box-shadow .06s ease}
  .btn:active{transform:translateY(1px);box-shadow:0 2px 6px rgba(8,12,20,0.05)}
  .btn.secondary{background:#fff;border:1px solid rgba(8,12,20,0.04)}
  .btn.large{grid-column:span 2}
  .btn.result{background:var(--result-btn);color:#fff;border:0}
  .btn.clear{background:var(--clear-btn);color:#fff;border:0}
  .btn.op{background:#eaf4fb;color:var(--accent)}
  .btn.var{background:#fff4ee;color:var(--variable)}
  .btn.num{background:#eef8ff;color:var(--number)}
  .btn.gray{background:#f6f8fa;color:var(--muted)}
  .btn:hover{box-shadow:0 14px 30px rgba(11,18,32,0.06)}

  .footer{font-size:13px;color:var(--muted);text-align:center;margin-top:10px}

  @media (max-width:420px){
    .wrap{padding:12px}
    .result{font-size:24px}
    .btn{padding:10px 6px;font-size:15px}
  }

  /* accessible focus */
  .btn:focus{outline:3px solid rgba(29,185,148,0.12)}
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Scientific calculator">
    <header>
      <h1>Scientific Calculator — Pro</h1>
      <p class="lead">High-precision math (BigNumber), top UX, mobile-first. Numbers and variables highlighted. Result green, Clear red.</p>
    </header>

    <div class="card" aria-hidden="false">
      <div id="display" class="display" aria-live="polite">
        <div id="expr" class="expr" title=""></div>
        <div class="result">
          <div id="value">0</div>
          <div class="mode" id="mode">Deg</div>
        </div>
      </div>

      <div class="controls">
        <div style="display:flex;gap:8px;align-items:center">
          <div class="seg" role="radiogroup" aria-label="Angle unit">
            <label><input type="radio" name="angle" value="deg" checked>Deg</label>
            <label><input type="radio" name="angle" value="rad">Rad</label>
          </div>
          <div style="font-size:13px;color:var(--muted)">Ans: <strong id="ans">0</strong></div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn clear" id="AC">AC</button>
          <button class="btn secondary" id="back">Back</button>
        </div>
      </div>

      <div class="pad" id="pad">
        <!-- top row functions -->
        <button class="btn var" data-fn="sin">sin</button>
        <button class="btn var" data-fn="cos">cos</button>
        <button class="btn var" data-fn="tan">tan</button>
        <button class="btn var" data-fn="pi">π</button>
        <button class="btn var" data-fn="e">e</button>

        <button class="btn var" data-fn="asin">sin⁻¹</button>
        <button class="btn var" data-fn="acos">cos⁻¹</button>
        <button class="btn var" data-fn="atan">tan⁻¹</button>
        <button class="btn op" data-fn="powxy">xʸ</button>
        <button class="btn op" data-fn="x3">x³</button>

        <button class="btn op" data-fn="x2">x²</button>
        <button class="btn op" data-fn="exp">eˣ</button>
        <button class="btn op" data-fn="tenx">10ˣ</button>
        <button class="btn op" data-fn="ln">ln</button>
        <button class="btn op" data-fn="log">log</button>

        <button class="btn op" data-fn="sqrt">√x</button>
        <button class="btn op" data-fn="cuberoot">³√x</button>
        <button class="btn op" data-fn="nthroot">y√x</button>
        <button class="btn op" data-fn="percent">%</button>
        <button class="btn op" data-fn="factorial">n!</button>

        <!-- numbers & ops -->
        <button class="btn num" data-key="7">7</button>
        <button class="btn num" data-key="8">8</button>
        <button class="btn num" data-key="9">9</button>
        <button class="btn op" data-op="+">+</button>
        <button class="btn gray" id="ansBtn">Ans</button>

        <button class="btn num" data-key="4">4</button>
        <button class="btn num" data-key="5">5</button>
        <button class="btn num" data-key="6">6</button>
        <button class="btn op" data-op="-">−</button>
        <button class="btn gray" id="mPlus">M+</button>

        <button class="btn num" data-key="1">1</button>
        <button class="btn num" data-key="2">2</button>
        <button class="btn num" data-key="3">3</button>
        <button class="btn op" data-op="*">×</button>
        <button class="btn gray" id="mMinus">M-</button>

        <button class="btn num" data-key="0">0</button>
        <button class="btn num" data-key=".">.</button>
        <button class="btn op" data-fn="expNotation">EXP</button>
        <button class="btn op" data-op="/">÷</button>
        <button class="btn gray" id="mRec">MR</button>

        <button class="btn gray" data-fn="sign">±</button>
        <button class="btn gray" data-fn="rnd">RND</button>
        <button class="btn result large" id="equals">=</button>
        <button class="btn gray" data-fn="(">(</button>
        <button class="btn gray" data-fn=")">)</button>
      </div>

      <div class="footer">Keyboard: numbers, + - * / and Enter. Trig uses selected unit.</div>
    </div>
  </div>

<script>
/* PRO high-precision scientific calculator using math.js BigNumber
   - math.js configured for BigNumber arithmetic (64 digits)
   - expression builder + safe evaluate via math.evaluate
   - token highlighting: numbers vs variables
*/

if (!window.math) {
  alert('math.js failed to load. Please ensure you have network access to the CDN.');
}

// Configure math.js for BigNumber arithmetic with high precision
math.config({
  number: 'BigNumber',
  precision: 64
});

const exprEl = document.getElementById('expr');
const valueEl = document.getElementById('value');
const modeEl = document.getElementById('mode');
const ansEl = document.getElementById('ans');

let expression = '';      // visible expression string (user-built)
let lastAns = math.bignumber(0);
let memory = math.bignumber(0);
let angleMode = 'deg';

// UTIL: colorize tokens: numbers in --number, variables (Ans, M, PI, E) in --variable
function colorize(s){
  // escape html
  s = String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  // numbers (including decimals, exponent) - we wrap them
  s = s.replace(/([0-9]+(?:\.[0-9]+)?(?:e[+\-]?[0-9]+)?)/ig, '<span class="tok-num">$1</span>');
  // variables/tokens Ans, M, π, e
  s = s.replace(/\b(Ans|M|π|pi|e)\b/ig, '<span class="tok-var">$1</span>');
  return s;
}

function render(){
  exprEl.innerHTML = expression ? colorize(expression) : '';
  // show lastAns as formatted string when expression empty, else blank
  valueEl.textContent = expression ? '' : formatBN(lastAns);
  ansEl.textContent = formatBN(lastAns);
  modeEl.textContent = angleMode === 'deg' ? 'Deg' : 'Rad';
}

function formatBN(bn){
  try{
    if (bn === null || bn === undefined) return '0';
    // convert to number if small enough else use toPrecision/format smartly
    // math.format gives nice output
    return math.format(bn, {notation:'auto', precision: 14});
  }catch(e){
    return String(bn);
  }
}

// Button wiring
document.querySelectorAll('#pad .btn').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    const key = btn.getAttribute('data-key');
    const op = btn.getAttribute('data-op');
    const fn  = btn.getAttribute('data-fn');

    if (key) { expression += key; render(); return; }
    if (op)  { expression += ' ' + op + ' '; render(); return; }
    if (fn)  { handleFn(fn); return; }
  });
});

// controls
document.getElementById('AC').addEventListener('click', ()=>{
  expression = '';
  lastAns = math.bignumber(0);
  render();
});
document.getElementById('back').addEventListener('click', ()=>{
  // remove last token/char
  expression = expression.trimEnd();
  if (expression.length) {
    // remove last char
    expression = expression.slice(0, -1);
  }
  render();
});

document.getElementById('equals').addEventListener('click', evaluateExpression);
document.getElementById('ansBtn').addEventListener('click', ()=>{ expression += ' Ans '; render(); });
document.getElementById('mPlus').addEventListener('click', ()=>{ memory = math.add(memory, tryEvalCurrent()); });
document.getElementById('mMinus').addEventListener('click', ()=>{ memory = math.subtract(memory, tryEvalCurrent()); });
document.getElementById('mRec').addEventListener('click', ()=>{ expression += ' ' + formatBN(memory) + ' '; render(); });

// angle radio
document.querySelectorAll('input[name="angle"]').forEach(r=>{
  r.addEventListener('change', ()=>{ angleMode = document.querySelector('input[name="angle"]:checked').value; render(); });
});

/* FUNCTION HANDLERS */
function handleFn(name){
  try{
    switch(name){
      case 'pi': expression += ' pi '; break;
      case 'e': expression += ' e '; break;
      case 'expNotation': expression += ' E '; break;
      case 'sign': toggleSign(); break;
      case 'rnd': expression += ' ' + Math.random().toFixed(6) + ' '; break;
      case 'sin': wrapUnary('sin'); break;
      case 'cos': wrapUnary('cos'); break;
      case 'tan': wrapUnary('tan'); break;
      case 'asin': wrapUnary('asin'); break;
      case 'acos': wrapUnary('acos'); break;
      case 'atan': wrapUnary('atan'); break;
      case 'powxy': expression += ' ^ '; break;
      case 'x2': wrapUnaryRaw('x^2'); break;
      case 'x3': wrapUnaryRaw('x^3'); break;
      case 'exp': wrapUnary('exp'); break;
      case 'tenx': wrapUnaryRaw('10^x'); break;
      case 'ln': wrapUnary('log'); break;         // ln as log with base e
      case 'log': wrapUnary('log10'); break;
      case 'sqrt': wrapUnaryRaw('sqrt(x)'); break;
      case 'cuberoot': wrapUnaryRaw('cbrt(x)'); break;
      case 'nthroot': nthRootPrompt(); break;
      case 'percent': applyPercent(); break;
      case 'factorial': applyFactorial(); break;
      case '(':
      case ')': expression += name; break;
      default: break;
    }
    render();
  }catch(e){
    alert('Error: ' + e.message);
  }
}

// helper: apply unary by wrapping last value or Ans
function wrapUnary(fnName){
  // if expression empty use Ans, else evaluate current expression and apply function
  let v = tryEvalCurrent();
  if (v == null) { alert('Invalid expression'); return; }
  // trig conversions if necessary
  if (['sin','cos','tan'].includes(fnName)){
    if (angleMode === 'deg') v = math.multiply(v, math.pi).div(180);
    const result = math[fnName](v);
    lastAns = result;
    expression = '';
    return;
  }
  if (fnName === 'asin' || fnName === 'acos' || fnName === 'atan'){
    const fn = math[fnName];
    let r = fn(v);
    if (angleMode === 'deg') r = math.multiply(r, 180).div(math.pi);
    lastAns = r;
    expression = '';
    return;
  }
  // other unary functions: use math[fnName] if exists
  if (math[fnName]){
    lastAns = math[fnName](v);
    expression = '';
    return;
  }
  // fallback: try evaluate fnName(v)
  lastAns = math.evaluate(fnName + '(' + formatBN(v) + ')');
  expression = '';
}

// helper raw wrapper when we want textual insertion for e.g. x^2 of the current value
function wrapUnaryRaw(template){
  let v = tryEvalCurrent();
  if (v == null) { alert('Invalid expression'); return; }
  // replace x with numeric value and evaluate
  const expr = template.replace(/x/g, formatBN(v));
  try{
    const r = math.evaluate(expr);
    lastAns = r;
    expression = '';
  }catch(e){ alert('Error'); }
}

// nth root prompt
function nthRootPrompt(){
  const deg = prompt('Root degree (e.g. 3 for cube root). Default 2:','2');
  if (!deg) return;
  let v = tryEvalCurrent();
  if (v == null) return;
  const n = math.bignumber(deg);
  // compute sign-preserving root
  let val = math.nthRoot ? math.nthRoot(v, n) : math.pow(v, math.divide(1,n));
  lastAns = val;
  expression = '';
}

// percent: convert last number to number/100
function applyPercent(){
  try{
    // find last numeric token
    const m = expression.match(/([0-9]+(?:\.[0-9]+)?(?:e[+\-]?[0-9]+)?)\s*$/i);
    if (m){
      const num = m[1];
      const before = expression.slice(0, m.index);
      const bn = math.bignumber(num);
      const res = math.divide(bn, 100);
      expression = before + res.toString();
    } else {
      // apply to current evaluated value
      const v = tryEvalCurrent();
      if (v == null) return;
      lastAns = math.divide(v, 100);
      expression = '';
    }
  }catch(e){ alert('Percent error'); }
}

// factorial (integers only, limit)
function applyFactorial(){
  let v = tryEvalCurrent();
  if (v == null) return;
  try{
    const n = math.number(v);
    if (!Number.isInteger(n) || n < 0) { alert('Factorial requires a non-negative integer'); return; }
    if (n > 170) { alert('Number too large for factorial'); return; } // safe
    let res = math.factorial(n);
    lastAns = res;
    expression = '';
  }catch(e){ alert('Factorial error'); }
}

// tryEvalCurrent returns BigNumber or null
function tryEvalCurrent(){
  if (!expression || expression.trim() === '') return lastAns;
  try{
    const s = transformExpression(expression);
    const res = math.evaluate(s);
    return res;
  }catch(e){
    return null;
  }
}

// transform expression string before sending to math.evaluate
function transformExpression(s){
  let t = String(s);
  // replace unicode minus with hyphen
  t = t.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-');
  // replace Ans token with lastAns numeric string
  t = t.replace(/\bAns\b/ig, '(' + lastAns.toString() + ')');
  // replace pi/e with math constants
  t = t.replace(/\bπ\b/ig, '(' + math.pi.toString() + ')');
  t = t.replace(/\bpi\b/ig, '(' + math.pi.toString() + ')');
  t = t.replace(/\be\b/ig, '(' + math.e.toString() + ')');
  // allow caret ^ operator (math.js supports ^)
  // trimming multiple spaces
  t = t.replace(/\s+/g,' ');
  return t;
}

// evaluate
function evaluateExpression(){
  try{
    const s = transformExpression(expression || lastAns.toString());
    const res = math.evaluate(s);
    lastAns = res;
    expression = '';
    render();
  }catch(e){
    alert('Calculation error: ' + e.message);
  }
}

/* toggle sign: make last numeric token negative or positive */
function toggleSign(){
  expression = expression.trim();
  if (!expression) { lastAns = math.unaryMinus(lastAns); render(); return; }
  // find last numeric token
  const m = expression.match(/([0-9]+(?:\.[0-9]+)?(?:e[+\-]?[0-9]+)?)\s*$/i);
  if (!m){ expression = '-' + expression; render(); return; }
  const num = m[1];
  const idx = m.index;
  const before = expression.slice(0, idx);
  const bn = math.bignumber(num);
  const neg = math.unaryMinus(bn).toString();
  expression = before + neg;
  render();
}

/* keyboard support */
window.addEventListener('keydown', (ev)=>{
  const k = ev.key;
  if ((/^[0-9]$/).test(k)) { expression += k; render(); return; }
  if (k === '.') { expression += '.'; render(); return; }
  if (k === '+' || k === '-' || k === '*' || k === '/') { expression += ' ' + k + ' '; render(); return; }
  if (k === 'Enter') { evaluateExpression(); return; }
  if (k === 'Backspace') { expression = expression.slice(0,-1); render(); return; }
  if (k === '(' || k === ')') { expression += k; render(); return; }
  if (k === '^') { expression += ' ^ '; render(); return; }
});

// initial render
render();
</script>
</body>
</html>
